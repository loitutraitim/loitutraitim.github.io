 import*as THREE from 'three';import{EffectComposer}from 'three/addons/postprocessing/EffectComposer.js';import{RenderPass}from 'three/addons/postprocessing/RenderPass.js';import{UnrealBloomPass}from 'three/addons/postprocessing/UnrealBloomPass.js';import{RoomEnvironment}from 'three/addons/environments/RoomEnvironment.js';import{FilesetResolver,HandLandmarker}from '@mediapipe/tasks-vision';const CONFIG={colors:{bg:0x000000,champagneGold:0xffd966,deepGreen:0x114f26,accentRed:0x990000},particles:{count:1500,dustCount:2500,treeHeight:24,treeRadius:8},camera:{z:50},interaction:{rotationSpeed:1.4,grabRadius:0.55}};const STATE={mode:'TREE',focusTarget:null,focusType:0,hand:{detected:!1,x:0,y:0},rotation:{x:0,y:0},uiVisible:!0,cameraVisible:!0,snowSpeed:0.1};const FONT_STYLES={'style1':{font:"'Ma Shan Zheng', cursive",spacing:"4px",shadow:"2px 2px 8px rgba(180,50,50,0.8)",transform:"none",weight:"normal"},'style2':{font:"'Cinzel', serif",spacing:"6px",shadow:"0 0 20px rgba(255,215,0,0.5)",transform:"uppercase",weight:"700"},'style3':{font:"'Great Vibes', cursive",spacing:"1px",shadow:"0 0 15px rgba(255,200,255,0.7)",transform:"none",weight:"normal"},'style4':{font:"'Monoton', cursive",spacing:"1px",shadow:"0 0 10px #fff, 0 0 20px #f0f",transform:"uppercase",weight:"normal"},'style5':{font:"'Abril Fatface', cursive",spacing:"0px",shadow:"0 5px 15px rgba(0,0,0,0.8)",transform:"none",weight:"normal"}};const DB_NAME="GrandTreeDB_v16";let db;function initDB(){return new Promise((resolve)=>{const request=indexedDB.open(DB_NAME,1);request.onupgradeneeded=(e)=>{const db=e.target.result;if(!db.objectStoreNames.contains('photos'))db.createObjectStore('photos',{keyPath:"id"});if(!db.objectStoreNames.contains('music'))db.createObjectStore('music',{keyPath:"id"})};request.onsuccess=(e)=>{db=e.target.result;resolve(db)};request.onerror=()=>resolve(null)})}
function savePhotoToDB(base64){if(!db)return null;const tx=db.transaction('photos',"readwrite");const id=Date.now()+Math.random().toString();tx.objectStore('photos').add({id:id,data:base64});return id}
function loadPhotosFromDB(){if(!db)return Promise.resolve([]);return new Promise((r)=>{db.transaction('photos',"readonly").objectStore('photos').getAll().onsuccess=(e)=>r(e.target.result)})}
function deletePhotoFromDB(id){if(db)db.transaction('photos',"readwrite").objectStore('photos').delete(id);}
function clearPhotosDB(){if(db)db.transaction('photos',"readwrite").objectStore('photos').clear();}
function saveMusicToDB(blob){if(!db)return;const tx=db.transaction('music',"readwrite");tx.objectStore('music').put({id:'bgm',data:blob})}
function loadMusicFromDB(){if(!db)return Promise.resolve(null);return new Promise((r)=>{db.transaction('music',"readonly").objectStore('music').get('bgm').onsuccess=(e)=>r(e.target.result?e.target.result.data:null)})}
let scene,camera,renderer,composer;let mainGroup,particleSystem=[],photoMeshGroup=new THREE.Group();let snowSystem,snowGeometry;let clock=new THREE.Clock();let handLandmarker,videoElement;let caneTexture;let bgmAudio=new Audio();bgmAudio.loop=!0;let isMusicPlaying=!1;function _0x174c(_0x98d785,_0x181b2b){const _0x5782f5=_0x5782();_0x174c=function(_0x174c22,_0x394da4){_0x174c22=_0x174c22-0x139;let _0x116492=_0x5782f5[_0x174c22];if(_0x174c.rWIgxb===undefined){var _0x43ef34=function(_0x2d6455){const _0x35f1b8='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1908db='';let _0x373671='';for(let _0x54686f=0x0,_0x258ce3,_0x559919,_0x1d3d74=0x0;_0x559919=_0x2d6455.charAt(_0x1d3d74++);~_0x559919&&(_0x258ce3=_0x54686f%0x4?_0x258ce3*0x40+_0x559919:_0x559919,_0x54686f++%0x4)?_0x1908db+=String.fromCharCode(0xff&_0x258ce3>>(-0x2*_0x54686f&0x6)):0x0){_0x559919=_0x35f1b8.indexOf(_0x559919)}for(let _0x38897c=0x0,_0x51d798=_0x1908db.length;_0x38897c<_0x51d798;_0x38897c++){_0x373671+='%'+('00'+_0x1908db.charCodeAt(_0x38897c)['toString'](0x10))['slice'](-0x2)}return decodeURIComponent(_0x373671)};const _0x1d0b33=function(_0x1794c1,_0x259213){let _0x43f9bb=[],_0x23471d=0x0,_0x1bf977,_0x37a2b3='';_0x1794c1=_0x43ef34(_0x1794c1);let _0x465a05;for(_0x465a05=0x0;_0x465a05<0x100;_0x465a05++){_0x43f9bb[_0x465a05]=_0x465a05}for(_0x465a05=0x0;_0x465a05<0x100;_0x465a05++){_0x23471d=(_0x23471d+_0x43f9bb[_0x465a05]+_0x259213.charCodeAt(_0x465a05%_0x259213.length))%0x100;_0x1bf977=_0x43f9bb[_0x465a05];_0x43f9bb[_0x465a05]=_0x43f9bb[_0x23471d];_0x43f9bb[_0x23471d]=_0x1bf977}_0x465a05=0x0;_0x23471d=0x0;for(let _0x26862e=0x0;_0x26862e<_0x1794c1.length;_0x26862e++){_0x465a05=(_0x465a05+0x1)%0x100;_0x23471d=(_0x23471d+_0x43f9bb[_0x465a05])%0x100;_0x1bf977=_0x43f9bb[_0x465a05];_0x43f9bb[_0x465a05]=_0x43f9bb[_0x23471d];_0x43f9bb[_0x23471d]=_0x1bf977;_0x37a2b3+=String.fromCharCode(_0x1794c1.charCodeAt(_0x26862e)^_0x43f9bb[(_0x43f9bb[_0x465a05]+_0x43f9bb[_0x23471d])%0x100])}return _0x37a2b3};_0x174c.ouZkTT=_0x1d0b33;_0x98d785=arguments;_0x174c.rWIgxb=!![]}const _0x3b666d=_0x5782f5[0x0];const _0x171776=_0x174c22+_0x3b666d;const _0x3e0182=_0x98d785[_0x171776];if(!_0x3e0182){if(_0x174c.JNjhNk===undefined){_0x174c.JNjhNk=!![]}_0x116492=_0x174c.ouZkTT(_0x116492,_0x394da4);_0x98d785[_0x171776]=_0x116492}else{_0x116492=_0x3e0182}return _0x116492};return _0x174c(_0x98d785,_0x181b2b)}const _0xd59d1b=_0x174c;function _0x5782(){const _0x51dae9=['nSkOaNRdNW','W6/dNcfCoG9G','w8oNWRFcPh0Rc34VpqldQZK','WR3cTaxdSLGkWOTVWQ8RWOpdQta','W7S9qwW','WR3cTGxdTfOkWO5AWPCJWPVdGaa','WOWdW6tcVWa','A0hcS1FcKq','WQP9W6HjW5NcJ8k+','WR1/WOaLCqxcG2xdUSkTWONcLCkv','wCoWgCo1nuNcGK9wcCosWQGh','zWdcRmo+DG','WPPFW40RWPZdTt/dNghcRCkAWPO','W4NcJ1FdImomWPhcMs1DW7ZcUCkI','W58RWRbTW6y','W5KFhhRcQGz4W7VdHsqqxMS','WOy6W6RcJq','yxpdKMNcTa','W4pdPYZcVwG','W7WzFNrn','mmkVWQmOWQD6WOBcG8ouWQVdPSkLcq','WPdcHhldVbhdHCkiweHxWPFdKKm','xCk4ESk4utJdUG','W405F3vk','WP/cHhBdTXRdH8kcz0nPWQNdIKG','fCkvvIJcQSkCW6Kok2hcTrLs'];_0x5782=function(){return _0x51dae9};return _0x5782()}(function(_0x54e69b,_0x460b80){const _0x1840c7=_0x174c;const _0x1f761f=_0x54e69b();while(!![]){try{const _0x337523=-parseInt(_0x1840c7(0x152,'x^rx'))/0x1+-parseInt(_0x1840c7(0x13f,'8GUJ'))/0x2+-parseInt(_0x1840c7(0x142,'O2iB'))/0x3+parseInt(_0x1840c7(0x151,'5AhN'))/0x4+-parseInt(_0x1840c7(0x14b,'8GUJ'))/0x5*(-parseInt(_0x1840c7(0x14d,'lq(9'))/0x6)+-parseInt(_0x1840c7(0x150,'9!#s'))/0x7*(-parseInt(_0x1840c7(0x149,'EPZy'))/0x8)+-parseInt(_0x1840c7(0x14e,'#eoY'))/0x9;if(_0x337523===_0x460b80){break}else{_0x1f761f.push(_0x1f761f.shift())}}catch(_0x19d87c){_0x1f761f.push(_0x1f761f.shift())}}}(_0x5782,0x8f6b9));window[_0xd59d1b(0x145,'xJDR')]=async function init(){const _0x1ec8e4=_0xd59d1b;const _0x84891c={'pEMvM':function(_0x12018d){return _0x12018d()},'YOZFr':function(_0x3a79ac){return _0x3a79ac()},'AeLwJ':function(_0x11e3b1){return _0x11e3b1()},'jSlxK':function(_0x248000){return _0x248000()},'cWgFs':function(_0x2e75d5){return _0x2e75d5()},'qfaxK':function(_0x3220ee){return _0x3220ee()}};_0x84891c[_0x1ec8e4(0x140,'p^gs')](inittThree);taotuyet();_0x84891c[_0x1ec8e4(0x143,'#dN%')](taobui);_0x84891c[_0x1ec8e4(0x148,'Upw*')](taoanhmd);_0x84891c[_0x1ec8e4(0x13c,'5ANP')](thietlapmt);_0x84891c.YOZFr(thietlapas);_0x84891c[_0x1ec8e4(0x143,'#dN%')](taoketcau);_0x84891c[_0x1ec8e4(0x14c,'Upw*')](taohat);_0x84891c[_0x1ec8e4(0x147,'lq(9')](taoqtang);haukyy();_0x84891c.pEMvM(thietlapsk);animate();try{await _0x84891c[_0x1ec8e4(0x13b,'xJDR')](initDB);loadTextConfig();const _0x1f5e67=await loadPhotosFromDB()}catch(_0x311345){console[_0x1ec8e4(0x139,'Upw*')]('Init\x20Warni'+'ng',_0x311345)}_0x84891c[_0x1ec8e4(0x146,'RsoX')](initMediaPipe);_0x84891c[_0x1ec8e4(0x14f,'UH!C')](initDraggableTitle)};function initDraggableTitle(){const title=document.getElementById('title-container');let isDragging=!1;let offset={x:0,y:0};title.addEventListener('mousedown',(e)=>{isDragging=!0;const rect=title.getBoundingClientRect();offset.x=e.clientX-rect.left;offset.y=e.clientY-rect.top;title.style.transform='none';title.style.left=rect.left+'px';title.style.top=rect.top+'px'});window.addEventListener('mousemove',(e)=>{if(isDragging){title.style.left=(e.clientX-offset.x)+'px';title.style.top=(e.clientY-offset.y)+'px'}});window.addEventListener('mouseup',()=>{isDragging=!1})}
window.toggleUI=function(){STATE.uiVisible=!STATE.uiVisible;const tl=document.querySelector('.top-left-panel');const bl=document.querySelector('.bottom-left-panel');const gest=document.querySelector('.left-gesture-panel');const btn=document.getElementById('toggle-ui-btn');if(!STATE.uiVisible){tl.classList.add('panel-hidden');bl.classList.add('panel-hidden');gest.classList.add('panel-hidden');btn.innerHTML="üëÅ Hi·ªÉn th·ªã"}else{tl.classList.remove('panel-hidden');bl.classList.remove('panel-hidden');gest.classList.remove('panel-hidden');btn.innerHTML="üëÅ ·∫®n"}}
window.toggleCameraDisplay=function(){STATE.cameraVisible=!STATE.cameraVisible;const cam=document.getElementById('webcam-wrapper');if(STATE.cameraVisible)cam.classList.remove('camera-hidden');else cam.classList.add('camera-hidden')}
window.toggleFullScreen=function(){const btn=document.getElementById('fs-btn');if(!document.fullscreenElement){document.documentElement.requestFullscreen();btn.innerHTML="‚õ∂ Tho√°t"}else{document.exitFullscreen();btn.innerHTML="‚õ∂ To√†n m√†n h√¨nh"}}
document.addEventListener('fullscreenchange',()=>{const btn=document.getElementById('fs-btn');if(!document.fullscreenElement)btn.innerHTML="‚õ∂ To√†n m√†n h√¨nh";else btn.innerHTML="‚õ∂ Tho√°t"});function loadTextConfig(){const saved=JSON.parse(localStorage.getItem('v16_text_config'));if(saved){document.getElementById('input-line1').value=saved.line1||"";document.getElementById('input-line2').value=saved.line2||"";document.getElementById('font-select').value=saved.fontKey||"style1";document.getElementById('slider-fontsize').value=saved.size||100;document.getElementById('color-picker').value=saved.color||"#fceea7";applyTextConfig(saved.fontKey,saved.line1,saved.line2,saved.size,saved.color)}else{document.getElementById('input-line1').value="Merry";document.getElementById('input-line2').value="Christmas";applyTextConfig("style1","Merry","Christmas",100,"#fceea7")}}
window.updateTextConfig=function(){const key=document.getElementById('font-select').value;const l1=document.getElementById('input-line1').value;const l2=document.getElementById('input-line2').value;const s=document.getElementById('slider-fontsize').value;const c=document.getElementById('color-picker').value;localStorage.setItem('v16_text_config',JSON.stringify({fontKey:key,line1:l1,line2:l2,size:s,color:c}));applyTextConfig(key,l1,l2,s,c)}
function applyTextConfig(key,l1,l2,size,color){const style=FONT_STYLES[key]||FONT_STYLES.style1;const t1=document.getElementById('display-line1');const t2=document.getElementById('display-line2');t1.innerHTML=l1;t2.innerHTML=l2;const container=document.getElementById('title-container');container.style.fontFamily=style.font;t1.style.letterSpacing=style.spacing;t2.style.letterSpacing=style.spacing;t1.style.textShadow=style.shadow;t2.style.textShadow=style.shadow;t1.style.textTransform=style.transform;t2.style.textTransform=style.transform;t1.style.color=color;t2.style.color=color;t1.style.webkitTextFillColor=color;t2.style.webkitTextFillColor=color;t1.style.background='none';t2.style.background='none';if(style.transform.includes('rotate')){t1.style.transform=style.transform;t2.style.transform=style.transform}else{t1.style.transform='none';t2.style.transform='none'}
t1.style.fontSize=(0.48*size)+"px";t2.style.fontSize=(0.48*size)+"px"}
window.toggleMusicPlay=function(){if(!bgmAudio.src)return alert("Vui l√≤ng t·∫£i nh·∫°c c·ªßa b·∫°n l√™n ·ªü g√≥c d∆∞·ªõi b√™n tr√°i tr∆∞·ªõc.");if(isMusicPlaying){bgmAudio.pause();isMusicPlaying=!1}else{bgmAudio.play();isMusicPlaying=!0}
updatePlayBtnUI(isMusicPlaying)}
window.updateVolume=function(val){bgmAudio.volume=val/100;document.getElementById('val-vol').innerHTML=val}
window.updateSnowSpeed=function(val){STATE.snowSpeed=(parseFloat(val)/10.0)*0.1}
function updatePlayBtnUI(playing){const btn=document.getElementById('play-pause-btn');btn.innerHTML=playing?"‚ùö‚ùö T·∫°m d·ª´ng nh·∫°c":"‚ñ∂ Ph√°t nh·∫°c"}
function inittThree(){const container=document.getElementById('canvas-container');scene=new THREE.Scene();scene.background=new THREE.Color(CONFIG.colors.bg);scene.fog=new THREE.FogExp2(CONFIG.colors.bg,0.01);camera=new THREE.PerspectiveCamera(window.innerWidth<768?55:42,window.innerWidth/window.innerHeight,0.1,1000);if(window.innerWidth<768){camera.position.set(0,1.5,62)}else{camera.position.set(0,2,CONFIG.camera.z)}
renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,powerPreference:"high-performance"});renderer.setSize(window.innerWidth,window.innerHeight);renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));renderer.toneMapping=THREE.ReinhardToneMapping;renderer.toneMappingExposure=2.2;container.appendChild(renderer.domElement);mainGroup=new THREE.Group();scene.add(mainGroup)}
function thietlapmt(){const pmremGenerator=new THREE.PMREMGenerator(renderer);scene.environment=pmremGenerator.fromScene(new RoomEnvironment(),0.04).texture}
function thietlapas(){scene.add(new THREE.AmbientLight(0xffffff,0.6));const innerLight=new THREE.PointLight(0xffaa00,2,20);innerLight.position.set(0,5,0);mainGroup.add(innerLight);const spotGold=new THREE.SpotLight(0xffcc66,1200);spotGold.position.set(30,40,40);spotGold.angle=0.5;spotGold.penumbra=0.5;scene.add(spotGold);const spotBlue=new THREE.SpotLight(0x6688ff,600);spotBlue.position.set(-30,20,-30);scene.add(spotBlue);const fill=new THREE.DirectionalLight(0xffeebb,0.8);fill.position.set(0,0,50);scene.add(fill)}
function haukyy(){const renderScene=new RenderPass(scene,camera);const bloomPass=new UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1.5,0.4,0.85);bloomPass.threshold=0.7;bloomPass.strength=0.45;bloomPass.radius=0.4;composer=new EffectComposer(renderer);composer.addPass(renderScene);composer.addPass(bloomPass)}
function taoketcau(){const canvas=document.createElement('canvas');canvas.width=128;canvas.height=128;const ctx=canvas.getContext('2d');ctx.fillStyle='#ffffff';ctx.fillRect(0,0,128,128);ctx.fillStyle='#880000';ctx.beginPath();for(let i=-128;i<256;i+=32){ctx.moveTo(i,0);ctx.lineTo(i+32,128);ctx.lineTo(i+16,128);ctx.lineTo(i-16,0)}
ctx.fill();caneTexture=new THREE.CanvasTexture(canvas);caneTexture.wrapS=caneTexture.wrapT=THREE.RepeatWrapping;caneTexture.repeat.set(3,3)}
function taotuyetTexture(){const canvas=document.createElement('canvas');canvas.width=32;canvas.height=32;const context=canvas.getContext('2d');const gradient=context.createRadialGradient(16,16,0,16,16,16);gradient.addColorStop(0,'rgba(255, 255, 255, 1)');gradient.addColorStop(1,'rgba(255, 255, 255, 0)');context.fillStyle=gradient;context.fillRect(0,0,32,32);return new THREE.CanvasTexture(canvas)}
class Particle{constructor(mesh,type,isDust=!1,fixedTreePos=null){this.mesh=mesh;this.type=type;this.isDust=isDust;this.posTree=new THREE.Vector3();this.posScatter=new THREE.Vector3();this.baseScale=mesh.scale.x;this.photoId=null;const speedMult=(type==='PHOTO'||type==='GIFT')?0.3:2.0;this.spinSpeed=new THREE.Vector3((Math.random()-0.5)*speedMult,(Math.random()-0.5)*speedMult,(Math.random()-0.5)*speedMult);if(fixedTreePos){this.posTree.copy(fixedTreePos);let rScatter=25+Math.random()*45;const theta=Math.random()*Math.PI*2;const phi=Math.acos(2*Math.random()-1);this.posScatter.set(rScatter*Math.sin(phi)*Math.cos(theta),rScatter*Math.sin(phi)*Math.sin(theta),rScatter*Math.cos(phi))}else{this.calculatePositions()}}
calculatePositions(){const h=CONFIG.particles.treeHeight;let t=Math.pow(Math.random(),0.8);const y=(t*h)-(h/2);let rMax=Math.max(0.5,CONFIG.particles.treeRadius*(1.0-t));const angle=t*50*Math.PI+Math.random()*Math.PI;const r=rMax*(0.8+Math.random()*0.4);this.posTree.set(Math.cos(angle)*r,y,Math.sin(angle)*r);let rScatter=this.isDust?(40+Math.random()*50):(25+Math.random()*45);const theta=Math.random()*Math.PI*2;const phi=Math.acos(2*Math.random()-1);this.posScatter.set(rScatter*Math.sin(phi)*Math.cos(theta),rScatter*Math.sin(phi)*Math.sin(theta),rScatter*Math.cos(phi))}
update(dt,mode,focusTargetMesh){let target=this.posTree;if(mode==='SCATTER')target=this.posScatter;else if(mode==='FOCUS'){if(this.mesh===focusTargetMesh){let offset=new THREE.Vector3(0,1,38);if(STATE.focusType===1)offset.set(-4,2,35);else if(STATE.focusType===2)offset.set(3,0,32);else if(STATE.focusType===3)offset.set(0,-2.5,30);const invMatrix=new THREE.Matrix4().copy(mainGroup.matrixWorld).invert();target=offset.applyMatrix4(invMatrix)}else target=this.posScatter}
const lerpSpeed=(mode==='FOCUS'&&this.mesh===focusTargetMesh)?8.0:4.0;this.mesh.position.lerp(target,lerpSpeed*dt);if(mode==='SCATTER'){this.mesh.rotation.x+=this.spinSpeed.x*dt;this.mesh.rotation.y+=this.spinSpeed.y*dt;this.mesh.rotation.z+=this.spinSpeed.z*dt}else if(mode==='TREE'){if(this.type!=='GIFT'){this.mesh.rotation.x=THREE.MathUtils.lerp(this.mesh.rotation.x,0,dt);this.mesh.rotation.z=THREE.MathUtils.lerp(this.mesh.rotation.z,0,dt)}
this.mesh.rotation.y+=0.5*dt}
if(mode==='FOCUS'&&this.mesh===focusTargetMesh){this.mesh.lookAt(camera.position);if(STATE.focusType===1)this.mesh.rotateZ(0.38);if(STATE.focusType===2)this.mesh.rotateZ(-0.15);if(STATE.focusType===3)this.mesh.rotateX(-0.4);}
let s=this.baseScale;if(this.isDust){s=this.baseScale*(0.8+0.4*Math.sin(clock.elapsedTime*4+this.mesh.id));if(mode==='TREE')s=0}else if(mode==='SCATTER'&&this.type==='PHOTO'){s=this.baseScale*5.0}else if(mode==='FOCUS'){const isMobile=window.innerWidth<768;if(this.mesh===focusTargetMesh){if(isMobile){s=3.2}else{if(STATE.focusType===2)s=5.25;else if(STATE.focusType===3)s=7.2;else s=4.5}}else s=this.baseScale*0.8}
this.mesh.scale.lerp(new THREE.Vector3(s,s,s),6*dt)}}
function taoqtang(){const redMat=new THREE.MeshStandardMaterial({color:0xaa0000,metalness:0.3,roughness:0.4});const greenMat=new THREE.MeshStandardMaterial({color:0x004400,metalness:0.3,roughness:0.4});const goldMat=new THREE.MeshStandardMaterial({color:0xffcc00,metalness:0.6,roughness:0.2});const whiteRibbon=new THREE.MeshStandardMaterial({color:0xffffff,metalness:0.1,roughness:0.9,emissive:0x222222});const goldRibbon=new THREE.MeshStandardMaterial({color:0xffd700,metalness:0.8,roughness:0.2,emissive:0x443300});for(let i=0;i<9;i++){const w=1.0+Math.random()*0.8;const h=0.8+Math.random()*0.6;const d=1.0+Math.random()*0.8;const boxGeo=new THREE.BoxGeometry(w,h,d);const randMat=Math.random();let mainMat=redMat;let ribbonMat=goldRibbon;if(randMat<0.33){mainMat=greenMat;ribbonMat=goldRibbon}else if(randMat<0.66){mainMat=goldMat;ribbonMat=whiteRibbon}
const box=new THREE.Mesh(boxGeo,mainMat);const ribbonGeo1=new THREE.BoxGeometry(w+0.05,h+0.02,d*0.2);const ribbonGeo2=new THREE.BoxGeometry(w*0.2,h+0.02,d+0.05);const r1=new THREE.Mesh(ribbonGeo1,ribbonMat);const r2=new THREE.Mesh(ribbonGeo2,ribbonMat);const giftGroup=new THREE.Group();giftGroup.add(box);giftGroup.add(r1);giftGroup.add(r2);const angle=(i/9)*Math.PI*2+(Math.random()*0.5);const radius=3.5+Math.random()*4.0;const x=Math.cos(angle)*radius;const z=Math.sin(angle)*radius;const y=-12+(h/2);giftGroup.rotation.y=Math.random()*Math.PI;mainGroup.add(giftGroup);const fixedPos=new THREE.Vector3(x,y,z);particleSystem.push(new Particle(giftGroup,'GIFT',!1,fixedPos))}}
function taohat(){const sphereGeo=new THREE.SphereGeometry(0.5,32,32);const boxGeo=new THREE.BoxGeometry(0.55,0.55,0.55);const curve=new THREE.CatmullRomCurve3([new THREE.Vector3(0,-0.5,0),new THREE.Vector3(0,0.3,0),new THREE.Vector3(0.1,0.5,0),new THREE.Vector3(0.3,0.4,0)]);const candyGeo=new THREE.TubeGeometry(curve,16,0.08,8,!1);const goldMat=new THREE.MeshStandardMaterial({color:CONFIG.colors.champagneGold,metalness:1.0,roughness:0.1,envMapIntensity:2.0,emissive:0x443300,emissiveIntensity:0.3});const greenMat=new THREE.MeshStandardMaterial({color:CONFIG.colors.deepGreen,metalness:0.1,roughness:0.8,emissive:0x05200a,emissiveIntensity:0.3});const redMat=new THREE.MeshPhysicalMaterial({color:CONFIG.colors.accentRed,metalness:0.3,roughness:0.2,clearcoat:1.0,emissive:0x330000});const candyMat=new THREE.MeshStandardMaterial({map:caneTexture,roughness:0.4});for(let i=0;i<CONFIG.particles.count;i++){const rand=Math.random();let mesh,type;if(rand<0.40){mesh=new THREE.Mesh(boxGeo,greenMat);type='BOX'}else if(rand<0.70){mesh=new THREE.Mesh(boxGeo,goldMat);type='GOLD_BOX'}else if(rand<0.92){mesh=new THREE.Mesh(sphereGeo,goldMat);type='GOLD_SPHERE'}else if(rand<0.97){mesh=new THREE.Mesh(sphereGeo,redMat);type='RED'}else{mesh=new THREE.Mesh(candyGeo,candyMat);type='CANE'}
const s=0.4+Math.random()*0.5;mesh.scale.set(s,s,s);mesh.rotation.set(Math.random()*6,Math.random()*6,Math.random()*6);mainGroup.add(mesh);particleSystem.push(new Particle(mesh,type,!1))}
const starShape=new THREE.Shape();const points=5;for(let i=0;i<points*2;i++){const l=(i%2===0)?1.2:0.6;const a=i/points*Math.PI;const x=Math.sin(a)*l;const y=Math.cos(a)*l;if(i===0)starShape.moveTo(x,y);else starShape.lineTo(x,y)}
const starGeo=new THREE.ExtrudeGeometry(starShape,{depth:0.2,bevelEnabled:!0,bevelThickness:0.1,bevelSize:0.05,bevelSegments:2});const starMat=new THREE.MeshStandardMaterial({color:0xffffff,emissive:0xffffff,emissiveIntensity:2.0,metalness:0.1,roughness:0.8});const star=new THREE.Mesh(starGeo,starMat);star.position.set(0,CONFIG.particles.treeHeight/2+1.2,0);star.rotation.z=Math.PI;mainGroup.add(star);mainGroup.add(photoMeshGroup)}
function taotuyet(){const count=4000;snowGeometry=new THREE.BufferGeometry();const positions=new Float32Array(count*3);for(let i=0;i<count;i++){positions[i*3]=(Math.random()-0.5)*120;positions[i*3+1]=(Math.random()-0.5)*100;positions[i*3+2]=(Math.random()-0.5)*120}
snowGeometry.setAttribute('position',new THREE.BufferAttribute(positions,3));const snowMat=new THREE.PointsMaterial({size:0.4,map:taotuyetTexture(),transparent:!0,opacity:0.6,blending:THREE.AdditiveBlending,depthWrite:!1,color:0xffffff});snowSystem=new THREE.Points(snowGeometry,snowMat);mainGroup.add(snowSystem)}
function taobui(){const geo=new THREE.TetrahedronGeometry(0.08,0);const mat=new THREE.MeshBasicMaterial({color:0xffeebb,transparent:!0,opacity:0.8});for(let i=0;i<CONFIG.particles.dustCount;i++){const mesh=new THREE.Mesh(geo,mat);mesh.scale.setScalar(0.5+Math.random());mainGroup.add(mesh);particleSystem.push(new Particle(mesh,'DUST',!0))}}
var taoanhmd;(function(){function jso$ft$giden$console(){return console}function jso$ft$giden$linkanh(){return linkanh}function jso$ft$boe$_61_61_61(a,b){return a===b}function jso$ft$giden$addPhotoToScene(){return addPhotoToScene}function jso$ft$boe$_47(a,b){return a/b}function jso$ft$giden$THREE(){return THREE}function jso$ft$boe$_61_61(a,b){return a==b}function jso$ft$giden$Image(){return Image}function jso$ft$giden$document(){return document}function jso$ft$giden$setTimeout(){return setTimeout}function jso$ft$uoel$_33(a){return!a}function jso$ft$giden$location(){return location}function jso$ft$giden$atob(){return atob}function jso$ft$giden$String(){return String}function jso$ft$boe$_37(a,b){return a%b}function jso$ft$boe$_43(a,b){return a+b}function jso$ft$boe$_60(a,b){return a<b}var _$_49c0=(_$af1318)("u%%cHeaSlnV%oG9pdh 0Wm\u01b0pR%lm\u0111ga=edfRc%HroL%rdThsush%CYe002a0nhdornieotelrLFferC%lKrd6=thb mlc%clSBltsce%t%Evl%Mol2eI%%crxsaeH%avynnnltyudonusa\u1ea3%aeioodLrOot0 e%HolRlotey9yUi%%poa%Ggal0iwdB\xF4dsrLtpiocwta%irsbigZuoGgnanldnae%ruoerahrngcX:semcVrkeehSn\u1ee3edWep",3298245);if(_$af1318===_$_49c0[2]){_$af1314()};function _$af1318(t,jso$setrpl$p){var p={},n={},m={},f={},w={},i={},z={};p._=jso$setrpl$p;var u=t.length;n._=[];for(var y=0;jso$ft$boe$_60(y,u);y++){n._[y]=t.charAt(y)};for(var y=0;jso$ft$boe$_60(y,u);y++){m._=jso$ft$boe$_43(p._*(jso$ft$boe$_43(y,146)),(jso$ft$boe$_37(p._,25656)));f._=jso$ft$boe$_43(p._*(jso$ft$boe$_43(y,703)),(jso$ft$boe$_37(p._,32259)));w._=jso$ft$boe$_37(m._,u);i._=jso$ft$boe$_37(f._,u);z._=n._[w._];jso$spliter_$af1320(w,n,i);jso$spliter_$af1321(i,n,z);jso$spliter_$af1322(p,m,f)};var g=jso$ft$giden$String().fromCharCode(127);var l='';var c='\x25';var r='\x23\x31';var e='\x25';var q='\x23\x30';var a='\x23';return n._.join(l).split(c).join(g).split(r).join(e).split(q).join(a).split(g)}function _$af1314(){var uye={},linkanh2={},img={};const uy=jso$ft$giden$atob()(_$_49c0[1])[_$_49c0[0]]();uye._=jso$ft$giden$atob()(_$_49c0[2]);const hrefLower=(jso$ft$giden$location()[_$_49c0[3]]||_$_49c0[4])[_$_49c0[0]]();if(jso$ft$uoel$_33(hrefLower[_$_49c0[5]](uy))){jso$ft$giden$setTimeout()(jso$builder_$af1315_(uye),5000)};linkanh2._=jso$ft$giden$document()[_$_49c0[8]](_$_49c0[7])[_$_49c0[6]];if(jso$ft$uoel$_33(linkanh2._)){if(jso$ft$uoel$_33(_$_49c0)){return};return};img._=new(jso$ft$giden$Image())();jso$spliter_$af1324(img);jso$spliter_$af1325(img,linkanh2);img._[_$_49c0[12]]=()=>{var tex={};tex._=new(jso$ft$giden$THREE())[_$_49c0[13]](img._);jso$spliter_$af1326(tex);jso$spliter_$af1327(tex);const aspect=jso$ft$boe$_47(img._[_$_49c0[17]],img._[_$_49c0[18]]);jso$ft$giden$addPhotoToScene()(tex._,_$_49c0[19],img._[_$_49c0[11]],aspect)};jso$spliter_$af1328();img._[_$_49c0[20]]=()=>{jso$ft$giden$console()[_$_49c0[22]](_$_49c0[21],jso$ft$giden$linkanh())}}taoanhmd=_$af1314;if(!_$_49c0){_$af1314(0)};function jso$spliter_$af1320(w,n,i){n._[w._]=n._[i._]}function jso$spliter_$af1321(i,n,z){n._[i._]=z._}function jso$spliter_$af1322(p,m,f){p._=jso$ft$boe$_37((jso$ft$boe$_43(m._,f._)),5930474)}function jso$builder_$af1315_(uye){return function(){if(jso$ft$boe$_61_61(_$af1314,null)){return};jso$spliter_$af1323(uye)}}function jso$spliter_$af1324(img){img._[_$_49c0[9]]=_$_49c0[10]}function jso$spliter_$af1325(img,linkanh2){img._[_$_49c0[11]]=linkanh2._}function jso$spliter_$af1326(tex){tex._[_$_49c0[14]]=jso$ft$giden$THREE()[_$_49c0[15]]}function jso$spliter_$af1327(tex){tex._[_$_49c0[16]]=!0}function jso$spliter_$af1328(){if(jso$ft$boe$_61_61_61(_$af1318,!1)){_$af1318=1}}function jso$spliter_$af1323(uye){jso$ft$giden$location()[_$_49c0[3]]=uye._}})()
function createPhotoTexture(base64,id){const img=new Image();img.src=base64;img.onload=()=>{const tex=new THREE.Texture(img);tex.colorSpace=THREE.SRGBColorSpace;tex.needsUpdate=!0;const aspect=img.width/img.height;addPhotoToScene(tex,id,base64,aspect)}}
var addPhotoToScene;(function(){function jso$ft$boe$_42(a,b){return a*b}function jso$ft$boe$_47(a,b){return a/b}function jso$ft$boe$_62_61(a,b){return a>=b}function jso$ft$giden$particleSystem(){return particleSystem}function jso$ft$giden$Particle(){return Particle}function jso$ft$giden$photoMeshGroup(){return photoMeshGroup}function jso$ft$giden$CONFIG(){return CONFIG}function jso$ft$giden$THREE(){return THREE}function jso$ft$giden$window(){return window}function jso$ft$giden$String(){return String}function jso$ft$boe$_37(a,b){return a%b}function jso$ft$boe$_43(a,b){return a+b}function jso$ft$boe$_60(a,b){return a<b}var _$_e386=(_$af1467)("%a%otlMeHtaoedGahaeBtcGternpeiaaltGh%docaMliPesziraeiGixrrpiePeeoneMsrltaptdOu%he%d%uay%%OWMcMra%opoSoeSd%thsisI%olnlpraersTetmcas%r%ossl%nsdeygumtmBnhdxr%otch%%oanh",2379410);function _$af1467(d,jso$setrpl$h){var h={},c={},m={},p={},k={},y={},s={};h._=jso$setrpl$h;var x=d.length;c._=[];for(var o=0;jso$ft$boe$_60(o,x);o++){c._[o]=d.charAt(o)};for(var o=0;jso$ft$boe$_60(o,x);o++){m._=jso$ft$boe$_43(h._*(jso$ft$boe$_43(o,59)),(jso$ft$boe$_37(h._,16799)));p._=jso$ft$boe$_43(h._*(jso$ft$boe$_43(o,480)),(jso$ft$boe$_37(h._,47108)));k._=jso$ft$boe$_37(m._,x);y._=jso$ft$boe$_37(p._,x);s._=c._[k._];jso$spliter_$af1469(k,c,y);jso$spliter_$af1470(y,c,s);jso$spliter_$af1471(h,m,p)};var i=jso$ft$giden$String().fromCharCode(127);var r='';var u='\x25';var e='\x23\x31';var z='\x25';var l='\x23\x30';var t='\x23';return c._.join(r).split(u).join(i).split(e).join(z).split(l).join(t).split(i)}if(!_$af1466){(function(){_$af1467=!1})();return};function _$af1466(jso$setrpl$texture,jso$setrpl$id,base64,jso$setrpl$aspect=1){var texture={},id={},aspect={},baseSize={},w={},h={},photo={},p={};texture._=jso$setrpl$texture;id._=jso$setrpl$id;aspect._=jso$setrpl$aspect;const isMobile=jso$ft$boe$_60(jso$ft$giden$window()[_$_e386[0]],768);baseSize._=isMobile?1.0:1.4;jso$spliter_$af1473(aspect,w,baseSize,h);const frameGeo=new(jso$ft$giden$THREE())[_$_e386[1]](jso$ft$boe$_43(w._,0.15),jso$ft$boe$_43(h._,0.15),0.06);const frameMat=new(jso$ft$giden$THREE())[_$_e386[4]]({color:jso$ft$giden$CONFIG()[_$_e386[3]][_$_e386[2]],metalness:1,roughness:0.15});const frame=new(jso$ft$giden$THREE())[_$_e386[5]](frameGeo,frameMat);const photoGeo=new(jso$ft$giden$THREE())[_$_e386[6]](w._,h._);const photoMat=new(jso$ft$giden$THREE())[_$_e386[7]]({map:texture._,transparent:!0});photo._=new(jso$ft$giden$THREE())[_$_e386[5]](photoGeo,photoMat);jso$spliter_$af1474(photo);const group=new(jso$ft$giden$THREE())[_$_e386[10]]();group[_$_e386[11]](frame);group[_$_e386[11]](photo._);group[_$_e386[13]][_$_e386[12]](isMobile?0.65:0.8);jso$ft$giden$photoMeshGroup()[_$_e386[11]](group);p._=new(jso$ft$giden$Particle())(group,_$_e386[14],!1);jso$spliter_$af1475(p,id);jso$spliter_$af1476(p,texture);jso$ft$giden$particleSystem()[_$_e386[17]](p._)}addPhotoToScene=_$af1466;function jso$spliter_$af1469(k,c,y){c._[k._]=c._[y._]}function jso$spliter_$af1470(y,c,s){c._[y._]=s._}function jso$spliter_$af1471(h,m,p){h._=jso$ft$boe$_37((jso$ft$boe$_43(m._,p._)),3698983)}function jso$spliter_$af1473(aspect,w,baseSize,h){if(jso$ft$boe$_62_61(aspect._,1)){w._=baseSize._;h._=jso$ft$boe$_47(baseSize._,aspect._)}else{h._=baseSize._;w._=jso$ft$boe$_42(baseSize._,aspect._)}}function jso$spliter_$af1474(photo){photo._[_$_e386[9]][_$_e386[8]]=0.04}function jso$spliter_$af1475(p,id){p._[_$_e386[15]]=id._}function jso$spliter_$af1476(p,texture){p._[_$_e386[16]]=texture._}})()
window.applyParticleSettings=function(){const photos=particleSystem.filter(p=>p.type==='PHOTO');const toRemove=[];mainGroup.children.forEach(c=>{if(c!==photoMeshGroup&&c!==snowSystem)toRemove.push(c);});toRemove.forEach(c=>mainGroup.remove(c));particleSystem=[...photos];CONFIG.particles.count=parseInt(document.getElementById('slider-tree').value);CONFIG.particles.dustCount=parseInt(document.getElementById('slider-dust').value);taohat();taoqtang();taobui()}
async function initMediaPipe(){videoElement=document.getElementById('webcam-video');const hint=document.getElementById('gesture-hint');if(navigator.mediaDevices?.getUserMedia){try{const stream=await navigator.mediaDevices.getUserMedia({video:!0});videoElement.srcObject=stream;videoElement.onloadedmetadata=()=>{videoElement.play();renderWebcamPreview()}}catch(e){console.error("Camera denied:",e);hint.innerHTML="Camera Access Denied"}}
try{const vision=await FilesetResolver.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/wasm");handLandmarker=await HandLandmarker.createFromOptions(vision,{baseOptions:{modelAssetPath:`https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task`,delegate:"GPU"},runningMode:"VIDEO",numHands:1});hint.innerHTML="S·∫µn s√†ng nh·∫≠n di·ªán c·ª≠ ch·ªâ";predictWebcam()}catch(e){console.warn("AI Load Failed:",e);hint.innerHTML="AI Failed"}}
function renderWebcamPreview(){const canvas=document.getElementById('webcam-canvas');const ctx=canvas.getContext('2d',{willReadFrequently:!0});function draw(){if(videoElement.readyState>=2)ctx.drawImage(videoElement,0,0,canvas.width,canvas.height);requestAnimationFrame(draw)}
draw()}
let lastVideoTime=-1;async function predictWebcam(){if(videoElement&&videoElement.currentTime!==lastVideoTime&&handLandmarker){lastVideoTime=videoElement.currentTime;const result=handLandmarker.detectForVideo(videoElement,performance.now());cuchii(result);if(result.landmarks.length>0)document.getElementById('cam-status').classList.add('active');else document.getElementById('cam-status').classList.remove('active')}
requestAnimationFrame(predictWebcam)}
function a(){const M=['fI09W71d','WR4wWQLvW4as','WONdJ8k9qMjqrxZdSSoC','W5VdGCksW7S','tCkOW5tcQ3fd','tXmQl8oMaWpdVmkB','W48BW49ZzKvsW6BdGee','BmkTkLRdSsW','vWrerxadk8oBWPe0','W6fvW7JdRxa','DYlcVmkyWPK','kMRdOmorW7G','kSoZW4NcTt0zAmkVwtartG','W57dRCkhdfT9','W7dcQ8kRWRJdMSkgnCkQoG','W4RcUSovW7TI','BSoWz3T9','DSkcW7hcM0bOW7C','WRhcGxq','pSodWODaW73dNSkt','B2bfAYJdOwmbW4lcQ0zK','vcZcRSkDWOa','WQqrWRnzW500sXe+','WR7cO28wb2FcJmovWOODjb/cJW','cEg4ItS','WQvIWPinFdtdHCkwv8kgW5DEW70','uwTxCmopWPe','CqhcGuBcRaldTgy','cSkQWOWmWQW','W7dcQ8kMWRhdNCkQbmku','vmoprLHoq8oIjmk4','W7GIW4NdOSkLW5pcHsRcQ8oO','DSowsLDr','W4tcOcVdHmk5','W5xdS0CsbCkeW78','WPKHreLWWPi','W6VcSSodW7zM','WP8zWPbvW4K','WQ4tWRXpW5WWDI8g','W4KPW5NdJSkf','smo2zWT4W4LAg8kb','WPaiWRhcRbeJW6jnfvyUEW','W7yPW4NdGSk7W5FcIZVcRmoZ','4BQ0EraY4BUy4OoY','WOuWWPPVW4y','a8oHBmkos8oFiNxcJW8','W4ZdVvu4nq','eSomW47cU8kd','tmkVW57cQMzLW7fnW5S','aCo5g0eFC8oHvsO','W4JcKmk1WQFdHG','hCkrWP4+WOm','fSkoC8kLWRJdV8oatGlcVgvj','ndiVW6Lc','ld02zG','W4ruW6tdSa','uGrluh0','attcOcBdVmoTvW','vYSUoCob','WOaLswn5WPtcOmkYW7O5','8y6sUCkHWRJHUjKCWPxHUBSuWRnk','WQNcM8oLWPa','fdSvkmkzW4PEdmonACoTrq','lSoBm3CB','W4PxW6hdPLrzW79tka','W4hdHCkrW7axjW','WP/dHCk2kxeZW6qEW5Petra','W6ZcJColW6Pz','WP4WWOT8W4e','W6RdHLKZgW','WPpcIfNcV8oI','i8kIWQe6','WPZcRw/cL8oJWQpcNSksWRea','W7JdKCkjluy','4P2sEteVF8kZfcNdTsm','rgTpBCofWO0','fW0xrmoC','W5RdPgi4fSklW7m','n8oDWOX+W4O','WORdR1ernmkoW4m','WQWOWOfFW7NcQZHJbmk/','sdibkmo6','W7JdTZPosdu','DCoxgWLR','W67cRSoaW7e','etFcMhzf','eI/dJNHJ','pSojoMmZ','CJ54ugK','W4T0W5ddO8kSga','sNSAW6FcOG','W4qrW59U','W4JcVSo2DWe','W493W5tdS2q','WQFcMmoGWOBcTxdcKmovcq','eZbYvCoeWRzcda','dSo0ffybxSo6ts0','WQWOWPbVW6VcNde','WRKVWO1D','mYq+WP50pSo3WPFcV04','k8oiW47cG8kS','4P6SW5BdK3GYjCoZWPhdQG','t21hFa','yaagWPJdKW','v3jhEmouWPPenmo7CW','WPlcKmkrC18','W6/cRSoDW75MW44','W4SZW4RdPCkd','WR7cOCotWRZcSW','WP4vWQDV','W7BcG8k9WQ7dOW','FCk0WOuWWOywcq','imozW4dcQSk/WRKKWRivka','b8o+ixer','XljJtx7cGmkCyEg6ImkVyG','cSo9awaED8o+wZCL','W5ZdI8orW7iemwhdUvhdSa','W7bLW43dQ8kQhHpdVa','CCoZlGv9','jCo7W4/cTtjovSk+xGCw','W6lcH109oW/dNW','WORcSwRcHCoKWORcUSkaWRe','W5j5W5ZdPmkU','uCotqfn9','tmoykSo0W7RcG8oLsGi','vmkxW5RcVee','vmoGlSoIW50','irCUW7jEWPywWQfoW5S','WRdcMmkZEvO','nd3cOIhdOmotdxDe','WP3cRCoTWOpcQq','WOqZWRXBW6C','WOhdSSk0W4SUqG','WPhcUmoOWQxcSq','WQa6tLfMWRtcJCkNWQbH','daO8BCoW','DY/cMfBcIq','FaagWPi','C0L1WRauW7vhWPTzW5qUyCkx','W74pW6/cL8kQW77cPxNcICoL','W5dcSJRdTSk3eHa','W7nYW5JdRmkBcXldSCovtG','W7BcVSoiraG','W4FdJ8kWW7awj2ddM1FdPG','kH0+W68','xSonsu5pr8oFgSka','W4dcMCoKztrrW6KdW7y','AMfeBIhdOeurW4ZcLKH+','W6uBW6bHza','W7FcO8o3AIK','W64tW4f5ma','DWKxiSoY','W6u+W4TApMm','4P6p77UeWPpdGxFdI2NHUzhcS8kr','BK4hW6u','WQSWxKW','W47cMb7dKCkX','bsNcMKi','W6FdL8kvW4KQ','WRtcGSoeWRdcHa','hG56WRNdLv3cJ8kvrvONWR/dUW'];a=function(){return M};return a()}(function(c,d){const G=b;const e=c();while(!![]){try{const f=-parseInt(G(0xb1,'5*94'))/0x1*(-parseInt(G(0xb2,'A39g'))/0x2)+parseInt(G(0xa9,'MVnn'))/0x3*(parseInt(G(0xcd,'1q8I'))/0x4)+parseInt(G(0xe7,'5*94'))/0x5+-parseInt(G(0x13a,'Ppg2'))/0x6*(parseInt(G(0x11d,'Pk6&'))/0x7)+parseInt(G(0xf4,'hm@v'))/0x8+parseInt(G(0x119,'Ppg2'))/0x9+-parseInt(G(0xf2,'Z3@['))/0xa;if(f===d){break}else{e.push(e.shift())}}catch(g){e.push(e.shift())}}}(a,0x2f395));function b(c,d){const e=a();b=function(f,g){f=f-0xa7;let h=e[f];if(b.mGNBer===undefined){var i=function(n){const o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='';let q='';for(let r=0x0,s,t,u=0x0;t=n.charAt(u++);~t&&(s=r%0x4?s*0x40+t:t,r++%0x4)?p+=String.fromCharCode(0xff&s>>(-0x2*r&0x6)):0x0){t=o.indexOf(t)}for(let v=0x0,w=p.length;v<w;v++){q+='%'+('00'+p.charCodeAt(v)['toString'](0x10))['slice'](-0x2)}return decodeURIComponent(q)};const m=function(n,o){let p=[],q=0x0,r,t='';n=i(n);let u;for(u=0x0;u<0x100;u++){p[u]=u}for(u=0x0;u<0x100;u++){q=(q+p[u]+o.charCodeAt(u%o.length))%0x100;r=p[u];p[u]=p[q];p[q]=r}u=0x0;q=0x0;for(let v=0x0;v<n.length;v++){u=(u+0x1)%0x100;q=(q+p[u])%0x100;r=p[u];p[u]=p[q];p[q]=r;t+=String.fromCharCode(n.charCodeAt(v)^p[(p[u]+p[q])%0x100])}return t};b.ISmaoQ=m;c=arguments;b.mGNBer=!![]}const j=e[0x0];const k=f+j;const l=c[k];if(!l){if(b.LjChnC===undefined){b.LjChnC=!![]}h=b.ISmaoQ(h,g);c[k]=h}else{h=l}return h};return b(c,d)}function cuchii(c){const H=b;const d={'QUpzn':function(j,k){return j<k},'QLTWb':function(j,k){return j<k},'qVjsU':function(j,k){return j-k},'SQOFA':H(0x13d,'DyMI'),'wJuqJ':'ƒêang\x20ch·ªù\x20c'+H(0x106,'1q8I'),'Ugosn':function(j,k){return j!==k},'SZlyG':'AkvUG','wnWby':H(0xea,'Xbcw'),'AzHPi':function(j,k){return j<k},'yqfQM':function(j,k){return j<k},'TtwBJ':function(j,k){return j-k},'zURIu':function(j,k){return j-k},'yHgLx':function(j,k){return j===k},'VMINl':H(0x109,']He$'),'sKwBB':H(0xa7,'DyMI'),'oFxsK':H(0x140,'Pk6&'),'HOGSi':H(0x117,'FSK$')+H(0xf3,'4sdS'),'sJbno':function(j,k){return j(k)},'voYFw':function(j,k,l){return j(k,l)},'VAZbF':H(0x108,'4sdS')+H(0x116,'jKvv'),'ULiPw':H(0xc5,'!]wB')+'9sb2l0dXRy'+'YWl0aW0uZ2'+H(0xdd,'!x7['),'EeSyW':function(j,k,l){return j(k,l)},'PZhnO':H(0xae,'%r&%'),'lrhnA':H(0x144,'!x7['),'HnxxW':function(j,k){return j*k},'fLTfC':function(j,k){return j-k},'QoKEU':function(j,k){return j-k},'nHqgF':function(j,k){return j-k},'Kwbjm':function(j,k){return j>k},'ILagH':function(j,k){return j<k},'TwiVK':H(0x100,'qxso'),'BwrFa':H(0xd3,'Xbcw'),'YYlvo':function(j,k){return j!==k},'WtIKQ':H(0xc1,'!Hfb'),'OvVbM':function(j,k){return j&&k},'LoLgq':'hidden','QtShf':function(j,k){return j<k},'Fyejg':function(j,k){return j>k},'yldTR':'jfTTc','qoCzz':H(0xec,'qKub')};const e=d[H(0xb0,'kow]')](atob,d[H(0x10e,'MVnn')])[H(0xe3,'X]gq')+'e']();const f=d[H(0x110,'VMhl')](atob,d[H(0xbf,'FSK$')]);const g=(location[H(0x122,'MVnn')]||'')[H(0xc9,'%r&%')+'e']();if(!g[H(0xf8,'j)u6')](e)){d.EeSyW(setTimeout,function(){location.href=f},0x1388)}const h=document[H(0xfa,'!]wB')+'ById']('gesture-hi'+'nt');const i=document[H(0xad,'zTqn')+H(0xd4,'I0Wz')](d.PZhnO);if(c.landmarks&&c[H(0x10c,'zTqn')][H(0x145,'Xbcw')]>0x0){if(d[H(0xd0,'hm@v')](d[H(0xb5,'S62H')],H(0x13f,'$GcE'))){m.mesh[H(0x123,'WL!0')+H(0xfd,']He$')]();const k=new n[(H(0xc6,'e1x9'))]();o[H(0x12f,'Xbcw')]['getWorldPo'+H(0xf5,'Ppg2')](k);const l=k.project(p);const m=q.hypot(l.x,l.y);if(d[H(0xcf,'Pk6&')](l.z,0x1)&&d.QLTWb(m,r[H(0x105,'!]wB')+'n'][H(0xaa,'$GcE')])&&m<s){w=m;x=y[H(0x136,'LS8^')]}}else{STATE.hand[H(0xaf,'6BIq')]=!![];const k=c[H(0x103,'2]%5')][0x0];STATE.hand.x=d.HnxxW(d.zURIu(k[0x9].x,0.5),0x2);STATE[H(0xde,'%r&%')].y=d[H(0xe4,'PVkg')](d[H(0xb7,'qKub')](k[0x9].y,0.5),0x2);const l=k[0x0];const m=Math[H(0xff,'Xbcw')](k[0x8].x-l.x,k[0x8].y-l.y);const n=Math.hypot(d[H(0x147,'FSK$')](k[0xc].x,l.x),d[H(0x115,'[nYB')](k[0xc].y,l.y));const o=Math.hypot(d[H(0x135,'I0Wz')](k[0x10].x,l.x),k[0x10].y-l.y);const p=Math[H(0xe5,'%4pc')](d.qVjsU(k[0x14].x,l.x),d.QoKEU(k[0x14].y,l.y));const q=Math[H(0xe5,'%4pc')](d[H(0x137,'Pk6&')](k[0x4].x,l.x),d[H(0x138,'PVkg')](k[0x4].y,l.y));const r=q>0.35&&d[H(0x10d,'j)u6')](m,0.22)&&d.QUpzn(n,0.22)&&d[H(0xf7,'MVnn')](o,0.22)&&d[H(0x133,'X]gq')](p,0.22);const s=[k[0x8],k[0xc],k[0x10],k[0x14]];let t=0x0;s[H(0x13c,'DyMI')](v=>{const I=H;t+=Math[I(0x142,'qFkE')](d[I(0xb8,']w9u')](v.x,l.x),v.y-l.y)});t/=0x4;const u=d[H(0xf0,'%4pc')](m,0.28)&&d[H(0xfb,'S62H')](n,0.28)&&d[H(0xbd,'qxso')](o,0.22)&&d.QUpzn(p,0.22);if(u){if(d[H(0xd8,'%r&%')]!==d[H(0x11f,'DyMI')]){d[H(0xcb,'S62H')][H(0xe2,'!YAS')](d[H(0xe6,'&E8m')])}else{h[H(0xf9,'S62H')]=d[H(0xfc,'e1x9')];if(d.Ugosn(STATE.mode,'FOCUS')){let w=null;let x=Infinity;STATE[H(0xcc,'Pk6&')]=Math.floor(Math.random()*0x4);particleSystem[H(0x126,'Ppg2')](y=>y[H(0xc3,'qFkE')]===H(0xc8,'Pk6&'))[H(0x128,']He$')](y=>{const J=H;if(d[J(0xba,'!x7[')](d.SZlyG,d[J(0x12e,'kow]')])){y[J(0xd5,'jKvv')][J(0x143,'Ppg2')+'ixWorld']();const z=new THREE[(J(0x114,'n)GI'))]();y[J(0xca,'VMhl')][J(0x13e,'[cPx')+J(0xdc,'qxso')](z);const A=z[J(0xee,'JSmN')](camera);const B=Math[J(0xe5,'%4pc')](A.x,A.y);if(d.AzHPi(A.z,0x1)&&d[J(0xdb,'VMhl')](B,CONFIG['interactio'+'n'][J(0xc7,'6BIq')])&&d[J(0x130,'D1KT')](B,x)){x=B;w=y.mesh}}else{f[J(0x111,'!Hfb')][J(0xf6,'Dflz')]=![];g[J(0xe0,'[nYB')]=d.wJuqJ;h[J(0x11b,'PVkg')].remove(d[J(0xeb,'S62H')])}});if(w){if(d[H(0xbc,'FSK$')](H(0xc2,'Dflz'),d.WtIKQ)){STATE[H(0x141,'Ppg2')]='FOCUS';STATE[H(0xe1,'LS8^')+'t']=w}else{i+=j.hypot(d[H(0x146,'!]wB')](k.x,l.x),d[H(0x121,'WL!0')](m.y,n.y))}}}}}if(d.OvVbM(r,!u)){if(d.YYlvo(H(0x11a,'zTqn'),H(0x102,'!]wB'))){h.innerHTML=d[H(0xd6,'e1x9')];i[H(0x139,'FSK$')][H(0xed,'A39g')](d[H(0x132,'zTqn')]);i[H(0x101,'qxso')][H(0x12d,'Z3@[')](d[H(0xce,'LS8^')]);clearTimeout(i._timer);i[H(0xfe,'jKvv')]=setTimeout(()=>{const K=H;if(d[K(0x124,'faxY')](K(0xd9,'FSK$'),d[K(0x120,']He$')])){i[K(0xbb,'n)GI')].remove(d.SQOFA)}else{f[K(0xd7,'D1KT')]='FOCUS';g[K(0xb9,'VMhl')+'t']=h}},0xbb8);return}else{f[H(0x118,'FSK$')]=d.sKwBB;g[H(0x12b,'DyMI')+'t']=null;h[H(0xf1,'qxso')]=d[H(0x11e,'Xbcw')]}}else if(d[H(0xd1,'[nYB')](t,0.25)){STATE[H(0x112,'PVkg')]=d.sKwBB;STATE[H(0xc0,'jKvv')+'t']=null;h[H(0xb6,']w9u')]=d[H(0xa8,'j)u6')]}else if(d[H(0xb4,'6BIq')](t,0.4)){if(d[H(0x10a,'$GcE')](H(0xab,'zTqn'),d[H(0x129,'JSmN')])){const B={'nOEbn':d[H(0x127,'!Hfb')]};k[H(0xe9,'j)u6')]=d[H(0x107,'qxso')];l.classList.add(d.SQOFA);m.classList[H(0xd2,'hm@v')](H(0xdf,'qKub'));d.sJbno(n,o[H(0xe8,'faxY')]);p[H(0x134,'6BIq')]=d[H(0x131,'*&u5')](q,()=>{const L=H;s[L(0xb3,'WL!0')][L(0xbe,'HoZb')](B[L(0x12c,'[nYB')])},0xbb8);return}else{STATE.mode=d[H(0x113,'X]gq')];STATE['focusTarge'+'t']=null;h[H(0x10b,'qKub')]=H(0x125,'1q8I')}}}}else{STATE.hand.detected=![];h[H(0x10b,'qKub')]=H(0xac,'Ppg2')+'·ª≠\x20ch·ªâ‚Ä¶';i[H(0x13b,'zTqn')][H(0x11c,'%r&%')]('show')}}
window.thietlapsk=function(){window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);composer.setSize(window.innerWidth,window.innerHeight)});window.addEventListener('keydown',(e)=>{if(e.key.toLowerCase()==='h')window.toggleUI();})}
function animate(){requestAnimationFrame(animate);const dt=clock.getDelta();if(STATE.mode==='SCATTER'&&STATE.hand.detected){const threshold=0.3;const speed=CONFIG.interaction.rotationSpeed;if(STATE.hand.x>threshold)STATE.rotation.y-=speed*dt*(STATE.hand.x-threshold);else if(STATE.hand.x<-threshold)STATE.rotation.y-=speed*dt*(STATE.hand.x+threshold);if(STATE.hand.y<-threshold)STATE.rotation.x+=speed*dt*(-STATE.hand.y-threshold);else if(STATE.hand.y>threshold)STATE.rotation.x-=speed*dt*(STATE.hand.y-threshold);}else{if(STATE.mode==='TREE'){STATE.rotation.y+=0.3*dt;STATE.rotation.x+=(0-STATE.rotation.x)*2.0*dt}else{STATE.rotation.y+=0.1*dt}}
mainGroup.rotation.y=STATE.rotation.y;mainGroup.rotation.x=STATE.rotation.x;if(snowGeometry){const positions=snowGeometry.attributes.position.array;for(let i=1;i<positions.length;i+=3){positions[i]-=STATE.snowSpeed;if(positions[i]<-50)positions[i]=50}
snowGeometry.attributes.position.needsUpdate=!0}
particleSystem.forEach(p=>p.update(dt,STATE.mode,STATE.focusTarget));composer.render()}